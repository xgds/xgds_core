{% extends 'base_bootstrap.html' %}
{% load pipeline %}
{% load siteFrames %}

 {% block cssExtras %}
 {{ block.super }}
 <style>
 /* .grid-stack-item  {
 background-color: blue;
  margin: 20px 0 10px;
  padding-left: 5px;
  padding-right: 5px;
} */
 .grid-stack-item-content {
    display: block;
    margin: 20px 0 10px;
 }
 </style>
	{% include "xgds_map_server/MapServerCSS.html" %}
	<link rel="stylesheet" type="text/css" href="{{ EXTERNAL_URL }}gridstack/dist/gridstack.min.css" ></link>
	<link rel="stylesheet" type="text/css" href="{{ EXTERNAL_URL }}gridstack/dist/gridstack-extra.min.css" ></link>
 {% endblock cssExtras %}


{% block jsInit %}
	appOptions = {
		BODY_RADIUS_METERS: {{ settings.XGDS_MAP_SERVER_BODY_RADIUS_METERS }},
		DEFAULT_COORD_SYSTEM: "{{ settings.XGDS_MAP_SERVER_DEFAULT_COORD_SYSTEM }}",
		SETUP_COORD_SYSTEM: {{ settings.XGDS_MAP_SERVER_MAP_SETUP_COORD_SYSTEM }},
		DEFAULT_COORD_SYSTEM_CENTER: {{ settings.XGDS_MAP_SERVER_DEFAULT_COORD_SYSTEM_CENTER }},
		DEFAULT_ZOOM: {{ settings.XGDS_MAP_SERVER_DEFAULT_ZOOM }},
		DEFAULT_ROTATION: {{ settings.XGDS_MAP_SERVER_DEFAULT_ROTATION }},
		SHOW_COMPASS: {{ settings.XGDS_MAP_SERVER_SHOW_COMPASS}},
		selectedLayerUrl: "{{ settings.XGDS_MAP_SERVER_SELECTED_LAYER_URL }}",
		layerFeedUrl: "{{ settings.XGDS_MAP_SERVER_LAYER_FEED_URL }}",
		siteFrame: {% siteframe settings.XGDS_CURRENT_SITEFRAME_ID %},
		XGDS_MAP_SERVER_MAP_LOADED_CALLBACK: {{ settings.XGDS_MAP_SERVER_MAP_LOADED_CALLBACK }},
		dataUrl: "{{ settings.DATA_URL }}"
	};
	{% block jsInitPreApp %}
	{% endblock jsInitPreApp %}
	
	$(function(){
    	app.start(appOptions);
    	app.vent.on("mapSearch:drewFeatures", function(e) {
        	app.vent.trigger('mapSearch:fit');
            });
        {% block preLayout %}
		{% endblock preLayout %}
		
    	xgds_gridstack.initializeGridstack();
    	
    	{% block otherJSInit %}
		{% endblock otherJSInit %}
	});
	
{% endblock %}


{% block scripts %}
{{block.super}}
	{% include "xgds_core/timeJS.html" %}
	{% if app %}
	{% include "MapJS.html" %}
	{% else %}
	{% with app=settings.XGDS_MAP_SERVER_DEFAULT_BACKBONE_APP %}
	{% include "MapJS.html" %}
	{% endwith %}
	{% endif %}
	
	
	<script src="{{ EXTERNAL_URL }}lodash/lodash.min.js"></script>
    <script src="{{ EXTERNAL_URL }}jquery-ui/jquery-ui.min.js"></script>
    <script src="{{ EXTERNAL_URL }}gridstack/dist/gridstack.min.js" ></script>
    <!-- <script src="{{ STATIC_URL }}geocamUtil/js/datatable_helpers.js"></script> -->
    <script src="{{ STATIC_URL }}xgds_core/js/gridstackUtils.js"></script>
    
	{% javascript 'custom_map' %}
{% endblock scripts %}


{% block content %}
	{% block preDashboard %}
	{% endblock preDashboard %}
	{% block dashboard %}
	<div id="container" class="grid-stack grid-stack-6"> 
		
		{% block preMap %}
		{% endblock preMap %}
		
		
		{% block map %}
		<div id="map-gridstack-item" class="grid-stack-item" 
		data-gs-x="3" data-gs-y="0"
        data-gs-width="2" data-gs-height="2" >
        	<div>
			<i class="icon-lock-open pinDiv warning"></i>
        		{% siteframe_form %}
			<div class="grid-stack-item-content" id="map"></div>
			</div>
		</div>
		{% endblock map %}
		
		{% block layers %}
		<div id="map-gridstack-item" class="grid-stack-item" 
		data-gs-x="6" data-gs-y="0"
        data-gs-width="1" data-gs-height="2" >
        	<div>
			<div class="grid-stack-item-content" id="layers">
			<i class="icon-lock-open pinDiv warning"></i>
			</div>
			</div>
		</div>
		{% endblock layers %}
		
		
		{% block postMap %}
		{% endblock postMap %}
		
		
	</div> <!--  gridstack container -->
	{% endblock dashboard %}
{% endblock content %}